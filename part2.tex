% Метод управления трафиком в гибридной программно-определяемой сети
\section{Праграмнаe мадэліраваннe размеркавання патокаў у сетках SDN}

На аснове вышэй апісаных вывадаў разгледзем гібрыдную мадэль SDN
на аснове пратакола маршрутызацыі EIGRP.

Дадзены пратакол адносіцца да тыпу distance-vector, аднак, у адрозненне ад
RIP, ён выкарыстоўвае ў якасці асновы сваёй работы алгарытм дыфузійных вылічэнняў.

Маршрутызатары, якія ўдзельнічаюць у працы EIGRP абменьваюцца інфармацыяй аб прэфіксах, якія знаходзяцца ў табліцы маршрутызацыі кожнага з іх.

Інфармацыя аб прэфіксах змяшчае:
\begin{enumerate}
    \item IP-адрас сеткі;
    \item маску падсеткі;
    \item паласу прапускання сегмента гэтай сеткі;
    \item затрымку на інтэрфейсе маршрутызатара, які ўяўляе дадзены сегмент сеткі;
    \item нагрузку, якая дзейнічае на інтэрфейсе, які ўяўляе дадзены сегмент сеткі;
    \item надзейнасць, разлічаная на інтэрфейсе дадзенага сегмента сеткі;
    \item памер MTU.
\end{enumerate}

У якасці паласы прапускання сегмента сеткі перадаецца мінімальная
паласа прапускання па сеткаваму шляху, праз які праходзіць маршрут да зададзенай сеткі. У якасці затрымкі перадаецца сумарнаe значэнне затрымкі
для перадачы пакета па ўсіх каналах на маршруце да зададзенай сеткі. У якасці нагрузкі перадаецца максімальнае значэнне параметру txload па ўсіх каналах на маршруце да зададзенай сеткі, які аўтаматычна разлічваецца
на кожным інтэрфейсе маршрутызатара. У якасці надзейнасці перадаецца мінімальнае
значэнне адносін колькасці дакладна прынятых пакетаў да агульнай колькасці прынятых пакетаў па ўсіх каналах на маршруце да зададзенай сеткі. Значэнні
нагрузкі і надзейнасці вылічаюцца кожным маршрутызатарам паасобку
на інтэрфейсе, падключаным да канала, які з'яўляецца часткай маршруту
да зададзенай сеткі.

На аснове атрыманай інфармацыі аб прэфіксе маршрутызатар вылічвае метрыку.
У стандраце, які апісвае работу EIGRP, вызначаны 2 варыянты метрыкі:
стандартная і пашыраная. Стандартная метрыка разлічваецца маршрутызатарам
па формуле:
\begin{equation}
    CM = \left(K_1 \cdot BW_s + K_2 \cdot \frac{BW_s}{256 -Lo_\text{max}} + K_3 \cdot D_s\right) \cdot \left(\frac{K_5}{K4 + R_\text{min}}\right)
\end{equation}
\begin{Explanation}
    \item[дзе] $BW_s$ = $\frac{256 \cdot 10^7}{Bandwidth_\text{min}}$,
    $Lo_\text{max}$ -- нагрузка,
    $D_s$ -- $256 \cdot Delay_\text{сум}$,
    $R$ -- надзейнасць.
\end{Explanation}

Як бачна з формулы, пры разліку метрыкі для канкрэтнага прэфікса
выкарыстоўваецца параметр Load (нагрузка), максімальнае яго значэнне па ўсіх калах на маршруце да зададзенага прэфікса.
Каэфіцыенты $K_1$, $K_2$, $K_3$, $K_4$, $K_5$ ўяўляюць сабой вагавыя
каэфіцыенты, якія змяняюцца ад 0 да 255, яны служаць для таго, каб падчас разліку метрыкі
той ці іншы параметр аказваў большы ці меншы ўплыў на канчатковы
вынік разліку. Верхні парог --- 255 абумоўлены неабходнасцю маштабавання метрыкі да памеру ў 32 біты --- максімальнага памеру значэння
метрыкі ў табліцы маршрутызацыі. Ва ўсіх бягучых рэалізацыях EIGRP значэння
каэфіцыентаў: $K_1 = 1$, $K_2 = 0$, $K_3 = 1$, $K_4 = 0$, $K_5 = 0$, такім чынам рэальную ролю пры разліку
метрыкі гуляюць толькі затрымка і прапускная здольнасць.

Пры ўключэнні ў разлік параметра Load, гэта значыць устаноўка значэння
каэфіцыента $K_2 > 1$ гэты параметр ўлічваецца толькі пры першапачатковым
разліку метрыкі для маршруту. Пасля першага разліку і атрымання значэння
метрыкі нават пры змене параметру Load гэтыя змены не ўлічваюцца
і пераразлік метрыкі не вырабляецца. Дадзеная асаблівасць звязаная з наступнымі складанасцямі. Як вядома з палажэнняў тэорыі масавага абслугоўвання, нагрузка (трафік), якія генерыруюцца падлучанымі да сеткі прыладамі,
мае імавернасную прыроду, гэта значыць значэнне нагрузкі, якая прысутнічае ў сетцы
не пастаянная і змяняецца ў часе выпадковым чынам. размеркаванне імавернасці нагрузкі трафіку пры гэтым адрозніваецца, у залежнасці
ад тыпу сeрвісаў, якія прадстаўляюцца сеткай і тыпу прылад, падлучаных
да сеткі. У выніку, змена параметра Load, які адлюстроўвае змяненне
нагрузкі, якая дзейнічае на інтэрфейсе маршрутызатара, мае нелінейную
прыроду; змена таксама адбываецца ў адпаведнасці з дзеючым у дадзенай
сетцы законам размеркавання верагоднасцяў, з-за чаго значэнне параметру можа моцна адрознівацца па абсалютнай велічыні значэння на
кароткім інтэрвале часу. У выніку, часты пераразлік метрыкі з рознымі значэннямі параметру Load можа прыводзіць да частага
змянення маршруту для праходжання трафіку да зададзенага прэфікса, што:
\begin{enumerate}
    \item павялічвае затрымку пры перадачы трафіку;
    \item прыводзіць да страты некаторых пакетаў ў моманты нестабільнасці сеткі;
    \item выклікае змены ў паслядоўнасці перадаюцца пакетаў.
\end{enumerate}

Акрамя таго, змена метрыкі маршрута выклікае работу механізмаў
дыфузійных вылічэнняў, закладзеныя ў EIGRP, з-за чаго, інфармацыя
аб частых зменах метрыкі, і, адпаведна, маршрута, перадаецца
іншым маршрутызатарам, якія ўдзельнічаюць у працы EIGRP, якія таксама пералічваюць
метрыку і змяняюць рашэннe аб маршрутызацыі, што, у выніку, прыводзіць да
пастаяннага змянення ўсіх маршрутаў і нестабільнасці сеткі,
у выніку якіх негатыўныя фактары, пералічаныя вышэй, узмацняюцца
і павялічваецца колькасць адмоў у абслугоўванні, што адбіваецца на даступнасці інфармацыі, якая перадаецца па сетцы.
Па ўсіх названых прычынах, як было адзначана вышэй, пасля першага
разліку і атрымання значэння метрыкі нават пры змене параметру Load гэтыя
змены не ўлічваюцца і пераразлік метрыкі не робіцца.

\subsection{Алгарытм пераразліку нагрузкі}

Бягучая рэалізацыя пратакола не выкарыстоўвае параметры Load для разліку метрыкі. Для таго, каб абыйсці гэтыя абмежаванні, можна выкарыстоўваць
адаптыўны алгарытм рэагавання на змены нагрузкі, які задаецца рознасным раўнаннем:
\begin{equation}
    Load = \alpha \cdot Load + (1 - \alpha) \cdot Load_\text{new}\text{,} 0 <= \alpha <= 1.
\end{equation}

Згодна з асаблівасцю рознаснага раўнення, значэнне параметра Load,
якое вылічваецца за бягучы інтэрвал на кантролеры, будзе залежаць ад значэння
параметра Load, вылічанага на папярэднім інтэрвале і значэння параметра Load, атрыманага за бягучы інтэрвал ад маршрутызатара. Пры гэтым вага
апошняга ў агульным выніку вылічэнняў бягучага такту будзе залежаць ад
значэння каэфіцыента $\alpha$. З павелічэннем дадзенага каэфіцыента памяншаецца адчувальнасць дадзенага алгарытму да зменаў у нагрузцы, з памяншэннем дадзенага каэфіцыента павялічваецца адчувальнасць алгарытму
да зменаў у нагрузцы.

Пытанне аб тым, якое значэнне каэфіцыента выбраць
у выпадку канкрэтных тапалогіі і мадэлі трафіку (закона размеркавання імавернасці нагрузкі) з'яўляецца адкрытым і патрабуе далейшага даследавання.

На ўзроўні кантролера задаецца парогавае значэнне, якое забяспечвае ўмовы рэакцыі на змены ў нагрузцы, сумесна з заданнем каэфіцыента $\alpha$ вызначаецца агульная рэакцыя алгарытму на змены нагрузкі ў сетцы.
Паколькі пры вылічэнні метрыкі для маршруту маршрутызатарам выкарыстоўваюцца цэлыя значэння параметраў (прапускной здольнасці, затрымкі,
нагрузкі, надзейнасці), то і вылічэнні на ўзроўні кантролера мае сэнс
вырабляць з цэлымі лікамі, тады вынік вылічэнняў варта акругляць
да бліжэйшага цэлага значэння, каб пасля перадаваць маршрутызатару.
Вылічэнні робяцца для кожнага інтэрфейса маршрутызатара, параметры якога можа атрымаць кантролер.

Пасля таго, як з прычыны змены значэння нагрузкі было дасягнута пэўнае (зададзенае адміністратарам) парогавае значэнне гэтага параметра, кантролер перадае на маршрутызатары (адзін або некалькі) рашэнне
аб пераразліку маршрута. Паколькі маршрутызатар, які ўдзельнічае ў працы
EIGRP, вядомы бягучыя значэнні параметра нагрузкі, то перадача гэтых параметраў не патрабуецца. Пасля атрымання рашэння аб пераразліку маршрутаў
маршрутызатар запускае вылічэнні метрыкі для ўсіх маршрутаў, або для тых
маршрутаў, якія змяніліся значэннем метрыкі, згодна
бягучых спецыфікацыям EIGRP без усялякіх зменаў. Такая канчатковая рэалізацыя прапанаванага метаду задзейнічае ўжо наяўныя на сеткавых прыладах механізмы і алгарытмы і не патрабуе зменаў ні ў апаратнай, ні
ў праграмнай рэалізацыі сеткавых прылад. Прапанаваны алгарытм разам
з усімі вылічэннямі разгортваецца на кантролеры, у ролі якога можа
выступаць любая платформа, апаратная або праграмная з падтрымкай адпаведных праграмных інтэрфейсаў.

\subsection{Механізм збору інфармацыі з сеткавага вузла}

Разглядаемы вышэй алгарытм прапануецца выкарыстоўваць у рамках гібрыднай
рэалізацыі праграмна-вызначаных сетак.

Пры рэалізацыі дадзенага метада на практыцы выкарыстоўваліся:
\begin{enumerate}
    \item Сеткавае абсталяванне Cisco Systems Inc.;
    \item Restconf протокол для збору інфармацыі.
\end{enumerate}

RESTCONF аб'ядноўвае прастату HTTP з прадказальнасцю і магчымасцямі аўтаматызацыі кіраванымі схемамі API. Ведаючы модулі YANG, якія выкарыстоўваeцца сервер, кліент можа вывесці URL ўсіх рэсурсаў кіравання, а таксама прыдатную структуру ўсіх запытаў і водгукаў RESTCONF.

RESTCONF выкарыстоўвае бібліятэку YANG для прадастаўлення кліентам магчымасці знайсці інфармацыю у адпаведнасці з модулем YANG на сeрвэры, калі кліент хоча скарыстацца ёй.

Ідэнтыфікатары URI для залежных ад мадэлі даных аперацый RPC і змесціва сховішчаў прадказальныя на аснове азначэнняў у модулі YANG.

RESTCONF працуе з канцэптуальным сховішчам даных, вызначаным на мове мадэлявання YANG. Сервер пералічвае ўсе падтрымоўваныя модулі YANG з выкарыстаннем модуля ietf-yang-library. Сервер павінен рэалізаваць модуль ietf-yang-library, які павінен паказваць усе выкарыстоўваныя серверам модулі YANG ў спісе modules-state/module. Змесціва канцэптуальнага сховішчы даных, залежныя ад мадэлі аперацыі RPC і апавяшчэння аб падзеях таксама паказваюцца гэтым наборам модуляў YANG.

Класіфікацыя даных якія адносяцца ці якія не адносяцца да канфігурацый выводзіцца з аператара YANG config. Паводзіны, звязанае з парадкаваннем даных, вызначаецца аператарам YANG ordered-by. Даныя, якія не адносяцца да канфігурацыі, называюць таксама данымі стану.

Мадэль рэдагавання сховішчы даных у RESTCONF простая і прамалінейная, падобна паводзінам магчымасці :writable-running ў NETCONF. Кожнае рэдагаванне RESTCONF рэсурсу даных у рэсурсе сховішчы актывіруецца пасля паспяховага завяршэння рэдагавання.

\subsection{Рэалізацыя механізму пераразліку нагрузкі}

Праграма, якая рэалізуе вышэй апісаны алгарытм уліку нагрузкі, напісана
на аб'ектна-арыентаванай мове праграмавання Java. Выбар у якасці мовы праграмавання
Python абумоўлены яго шматплатформеннасцю, а таксама вялікай колькасцю модуляў і бібліятэк, якія пашыраюць базавы функцыянал.

Праграма складаецца з 3 асноўных частак:
\begin{enumerate}
    \item Recalculation --- клас, які збірае параметры нагрузкі на інтэрфейсах
    маршрутызатараў, а таксама ажыццяўляе яе пералік і парадае загад на
    пералік сеткавай тапалогіі;
    \item Router --- клас, які ўяўляе сабой апісанне маршртузатара, і рэалізуе
    метады збору і перадачы інфармацыі на маршрутызатар;
    \item Interface --- клас, які ўяўляе сабой апісанне інтэрфейса маршрутызатара,
    і рэалізуе метады збору інфармацыі з дадзенага інтэрфейса.
\end{enumerate}

На малюнку \ref{uml: Class Diagram} прадстаўлена дыяграма класаў.

\clearpage

\begin{figure}[ht!]
    \centering
    \includegraphics[width=\textwidth]{class_diagram.png}
    \caption{Дыяграма класаў праграмы пераліку нагрузкі}
    \label{uml: Class Diagram}
\end{figure}

\subsubsection{Апісанне класса Interface.}

Дадзены клас змяшчае ўсю неабходную інфармацыю пра інтэрфейс маршрутызатара і
рэалізуе метады для работы з ім.

Атрыбуты класа:
\begin{enumerate}
    \item name --- імя інтэрфейса на маршрутызатары (напрыклад, GigabitEthernet1);
    \item txload --- значэнне нагрузкі перадачы на інтэрфейсе.
\end{enumerate}

Метады класа:
\begin{enumerate}
    \item get\_name() --- вяртае імя інтэрфейса;
    \item get\_txload() --- вяртае значэнне нагрузкі перадачы на інтэрфейсе;
    \item set\_txload(txload) --- выстаўляе значэнне нагрузкі перадачы на інтэрфейсе
    роўным txload.
\end{enumerate}

\subsubsection{Апісанне класа Router.}

Дадзены клас змяшчае ўсю неабходную інфармацыю пра маршрутызатар і рэалізуе
метады для работы з ім.

Атрыбуты класа:
\begin{enumerate}
    \item host --- ip адрас маршрутызатара, на які будзе ажыццяўляцца падключэнне кантролерам;
    \item username --- імя карыстальніка для аўтэнтыфікацыі і аўтарызацыі;
    \item password --- паролькі карыстальніка для аўтэнтыфікацыі і аўтарызацыі;
    \item interfaces --- спіс усіх інтэрфейсаў на маршрутызатары.
\end{enumerate}

Метады класа:
\begin{enumerate}
    \item get\_host() --- вяртае ip адрас маршрутызатара;
    \item \_set\_interfaces() --- устанаўлівает інфармацыю пра інтэрфейсы на маршрутызатары;
    \item get\_interfaces() --- вяртае ўсе інтэрфейсы маршрутызатара;
    \item get\_interface\_names() --- вяртае ўсе назвы інтэрфейсаў;
    \item get\_interface\_txload(interface) --- вяртае нагрузку перадачы інтэрфейса;
    \item restart\_eigrp() --- перазагружае eigrp пратакол для пералічэння сеткавай тапалогіі;
    \item \_disable\_eigrp() --- адключае eigrp пратакол;
    \item \_enable\_eigrp() --- уключае eigrp пратакол.
\end{enumerate}

\subsubsection{Апісанне класа Recalculation.}

Дадзены клас адказвае за работу праграмы па адсочванні і пералічэнні нагрузкі на
маршрутызатары.

Атрыбуты класа:
\begin{enumerate}
    \item TIMEOUT --- прамежак часу (у секундах) праз які запрашваецца значэнне нагрузкі з інтэрфейсаў маршрутызатара;
    \item coefficient --- значэнне каэфіцыента $\alpha$;
    \item threshold --- парог рознасці паміж новай і старой нагрузкай, пры
    перавышэнні якога адпраўляецца каманда на перабудову сеткавай тапалогіі.
\end{enumerate}

Метад класа:
\begin{enumerate}
    \item recalculation(routers) --- выконвае маніторынг і пералік нагрузкі для маршрутызатараў, інфармацыя пра якіх была перададзена ў метад.
\end{enumerate}
